# sharedstreets-vector-tile

## Protocol buffer generated code

The file 'SharedStreetsProto.cs' is generated by tool 'protoc' based on the 'sharedstreets.proto' definition file.

- sharedstreets.proto file is copied from : https://github.com/sharedstreets/sharedstreets-ref-system/blob/master/proto/sharedstreets.proto

- tool protoc can be obtained from https://github.com/protocolbuffers/protobuf/releases

- Compile command (generates a c# file):

```
$ protoc sharedstreets.proto --csharp_out=.
```

sharedstreets is adapted a little bit to get the parsing going, by removing lines like:

```
_unknownFields = pb::UnknownFieldSet.MergeFieldFrom(_unknownFields, input);
```

## Sample code

```
var amsterdamTile = "./testfixtures/12-2103-1346.";
var geometryStream = File.OpenRead(amsterdamTile + "geometry.6.pbf");
var intersectionStream = File.OpenRead(amsterdamTile + "intersection.6.pbf");
var metadataStream = File.OpenRead(amsterdamTile + "metadata.6.pbf");
var referenceStream = File.OpenRead(amsterdamTile + "reference.6.pbf");

var geometry = SharedStreetsParser.ParseGeometry(geometryStream);
Assert.IsTrue(geometry.Lonlats.Count == 50906);
var intersection = SharedStreetsParser.ParseIntersection(intersectionStream);
Assert.IsTrue(intersection.Id == "7f1e47e658e554625c51c6fc6cdafcda");
var metadata = SharedStreetsParser.ParseMetadata(metadataStream);
Assert.IsTrue(metadata.OsmMetadata.WaySections.Count == 8431);
var reference = SharedStreetsParser.ParseReference(referenceStream);
Assert.IsTrue(reference.LocationReferences.Count == 17382);

## Api samples

Request: https://api.sharedstreets.io/v0.1.0/id/7f1e47e658e554625c51c6fc6cdafcda

Response: {"type":"INT","tiles":["osm/planet-180430/12-2103-1346.intersection.6.pbf","osm/planet-180730/12-2103-1346.intersection.6.pbf","osm/planet-181126/12-2103-1346.intersection.7.pbf","osm/planet-181029/12-2103-1346.intersection.6.pbf","osm/planet-181029/12-2103-1346.intersection.7.pbf","osm/planet-181029/12-2103-1346.intersection.8.pbf","osm/planet-180625/12-2103-1346.intersection.6.pbf","osm/planet-180528/12-2103-1346.intersection.6.pbf","osm/planet-180528/12-2103-1346.intersection.7.pbf","osm/planet-180827/12-2103-1346.intersection.6.pbf","osm/planet-180827/12-2103-1346.intersection.7.pbf","osm/planet-180924/12-2103-1346.intersection.6.pbf","osm/planet-180924/12-2103-1346.intersection.7.pbf","osm/planet-181126/12-2103-1346.intersection.6.pbf"]}
```
